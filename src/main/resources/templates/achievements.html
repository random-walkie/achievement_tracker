<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Achievements</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <link href="../static/css/styles.css">

</head>
<body>

<div class="container">
    <h2 class="mb-4">Achievements</h2>

    <!-- Filter Section -->
    <div class="row mb-3">
        <div class="col-md-4">
            <input type="text" id="searchInput" class="form-control" placeholder="Search by title...">
        </div>
        <div class="col-md-4">
            <select id="statusFilter" class="form-select">
                <option value="">All Statuses</option>
                <option value="TODO">TODO</option>
                <option value="IN_PROGRESS">IN_PROGRESS</option>
                <option value="COMPLETED">COMPLETED</option>
            </select>
        </div>
    </div>

    <!-- Achievements Table -->
    <div class="table-responsive table-container">
        <table class="table table-bordered table-hover">
            <thead class="table-dark">
            <tr>
                <th onclick="sortTable(0)">Title</th>
                <th> Description</th>
                <th onclick="sortTable(2)">Date Started</th>
                <th onclick="sortTable(3)">Date Completed</th>
                <th>Status</th>
                <th>Tags</th>
            </tr>
            </thead>
            <tbody id="achievementsTable">
            <tr th:if="${achievements.isEmpty()}">
                <td colspan="6" class="text-center text-muted">No achievements found</td>
            </tr>
            <tr th:each="achievement : ${achievements}" th:data-status="${achievement.status}">
                <td th:text="${achievement.title}"></td>
                <td th:text="${achievement.description}"></td>
                <td th:text="${achievement.dateStarted}"></td>
                <td th:text="${achievement.dateCompleted}"></td>
                <td th:text="${achievement.status}"
                    th:class="${achievement.status == 'COMPLETED' ? 'text-success' :
                                      (achievement.status == 'IN_PROGRESS' ? 'text-warning' : 'text-danger')}">
                </td>
                <td>
                    <span th:each="tag : ${achievement.tags}" class="badge bg-info me-1" th:text="${tag}"></span>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Bootstrap & Script for Sorting & Filtering -->
<script>
    document.getElementById("searchInput").addEventListener("keyup", function() {
        let filter = this.value.toLowerCase();
        let rows = document.querySelectorAll("#achievementsTable tr");
        rows.forEach(row => {
            let title = row.cells[0].textContent.toLowerCase();
            row.style.display = title.includes(filter) ? "" : "none";
        });
    });

    document.getElementById("statusFilter").addEventListener("change", function() {
        let filter = this.value;
        let rows = document.querySelectorAll("#achievementsTable tr");
        rows.forEach(row => {
            let status = row.getAttribute("data-status");
            row.style.display = (filter === "" || status === filter) ? "" : "none";
        });
    });

    let sortDirections = {}; // Store sorting state for each column

    function sortTable(n) {
        document.querySelector(".table");
        let tbody = document.querySelector("#achievementsTable");
        let rows = Array.from(tbody.querySelectorAll("tr")).filter(row => row.style.display !== "none");

        // Determine sorting direction (toggle)
        sortDirections[n] = !sortDirections[n]; // Flip sorting order
        let ascending = sortDirections[n];

        rows.sort((a, b) => {
            let aValue = a.cells[n].textContent.trim();
            let bValue = b.cells[n].textContent.trim();

            // Convert date values to proper Date objects for sorting
            if (n === 2 || n === 3) {
                aValue = new Date(aValue);
                bValue = new Date(bValue);
            }

            return ascending ? aValue > bValue ? 1 : -1 : aValue < bValue ? 1 : -1;
        });

        // Append sorted rows back to the table
        rows.forEach(row => tbody.appendChild(row));
    }


</script>

<!-- D3.js Charts Placeholder -->
<script>
    // D3.js script to visualize achievements (to be implemented)
</script>
</body>
</html>
